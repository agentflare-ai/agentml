---
title: "Events & Schemas"
description: "Structure your data with events and schemas for type-safe applications"
---

# Events & Schemas

Events are the primary communication mechanism in Agentic Flow. Schemas ensure your events are well-structured and validated.

## Understanding Events

### What Are Events?

Events are messages that flow through your application:

\`\`\`
# Emit an event
emit: user.message
  content: "Hello, world!"
  timestamp: 1234567890
  userId: "user123"

# Handle an event
on: user.message
  process: event.content
\`\`\`

### Event Naming

Use dot notation for hierarchical event names:

\`\`\`
user.message          # User sent a message
user.login            # User logged in
user.logout           # User logged out

llm.request           # LLM request started
llm.response          # LLM response received
llm.error             # LLM request failed

system.startup        # System started
system.shutdown       # System shutting down
\`\`\`

### Event Data

Events carry data in their payload:

\`\`\`
emit: user.message
  content: "What's the weather?"
  metadata:
    userId: "user123"
    timestamp: 1234567890
    channel: "web"
\`\`\`

Access event data with `event.*`:

\`\`\`
on: user.message
  log: event.content
  process:
    user: event.metadata.userId
    message: event.content
\`\`\`

## Defining Schemas

### Basic Schema

Define schemas to validate event data:

\`\`\`
schema: UserMessage
  content: string
  userId: string
  timestamp: number

on: user.message
  validate: UserMessage
  process: event.content
\`\`\`

### Schema Types

Supported data types:

\`\`\`
schema: CompleteExample
  # Primitives
  name: string
  age: number
  active: boolean
  
  # Arrays
  tags: string[]
  scores: number[]
  
  # Objects
  metadata:
    created: number
    updated: number
  
  # Optional fields
  nickname?: string
  
  # Enums
  status: "active" | "inactive" | "pending"
\`\`\`

### Nested Schemas

Create reusable nested schemas:

\`\`\`
schema: Address
  street: string
  city: string
  zipCode: string

schema: User
  name: string
  email: string
  address: Address
\`\`\`

### Array Schemas

Define arrays of objects:

\`\`\`
schema: Message
  content: string
  timestamp: number

schema: Conversation
  messages: Message[]
  participants: string[]
\`\`\`

## Schema Validation

### Automatic Validation

Validate events automatically:

\`\`\`
schema: UserMessage
  content: string
  userId: string

on: user.message
  validate: UserMessage
  # Only executes if validation passes
  process: event.content
\`\`\`

### Validation Errors

Handle validation failures:

\`\`\`
on: user.message
  validate: UserMessage
  
on: validation.error
  emit: error.occurred
    message: "Invalid message format"
    errors: event.errors
\`\`\`

### Custom Validation

Add custom validation rules:

\`\`\`
schema: UserMessage
  content: string
  userId: string
  
  validate:
    content.length > 0
    content.length < 1000
    userId.startsWith("user_")
\`\`\`

## Event Patterns

### Request-Response

Implement request-response patterns:

\`\`\`
# Request
emit: llm.request
  prompt: "What is 2+2?"
  requestId: "req123"

# Response
on: llm.response
  if: event.requestId == "req123"
    emit: calculation.complete
      result: event.text
\`\`\`

### Event Chaining

Chain events together:

\`\`\`
on: user.message
  emit: message.received
    content: event.content

on: message.received
  emit: message.processing
    content: event.content

on: message.processing
  emit: message.complete
    result: "processed"
\`\`\`

### Event Filtering

Filter events based on conditions:

\`\`\`
on: user.message
  if: event.content.includes("urgent")
    emit: priority.message
      content: event.content
  else:
    emit: normal.message
      content: event.content
\`\`\`

## Built-in Events

### System Events

Agentic Flow emits system events:

\`\`\`
on: system.startup
  log: "Application started"

on: system.shutdown
  log: "Application shutting down"

on: system.error
  log: event.error
\`\`\`

### State Events

State machine events:

\`\`\`
on: state.enter
  log: "Entered state: " + event.state

on: state.exit
  log: "Exited state: " + event.state

on: state.transition
  log: event.from + " -> " + event.to
\`\`\`

### Namespace Events

Events from namespaces:

\`\`\`
on: llm.request.started
  log: "LLM request started"

on: llm.request.completed
  log: "LLM request completed"

on: llm.request.failed
  log: "LLM request failed"
\`\`\`

## Event Lifecycle

### Event Flow

Understanding how events flow:

\`\`\`
1. Event emitted
   ↓
2. Schema validation (if defined)
   ↓
3. Event handlers triggered
   ↓
4. Actions executed
   ↓
5. New events emitted (if any)
\`\`\`

### Event Queue

Events are processed in order:

\`\`\`
emit: event.1
emit: event.2
emit: event.3

# Processed in order: 1, 2, 3
\`\`\`

### Event Priority

Set event priority:

\`\`\`
emit: high.priority
  priority: 10
  content: "Important!"

emit: low.priority
  priority: 1
  content: "Not urgent"
\`\`\`

## Advanced Patterns

### Event Aggregation

Aggregate multiple events:

\`\`\`
schema: UserAction
  action: string
  timestamp: number

on: user.click
  emit: user.action
    action: "click"
    timestamp: now()

on: user.scroll
  emit: user.action
    action: "scroll"
    timestamp: now()

# Aggregate all user actions
on: user.action
  aggregate:
    window: 1m
    emit: user.activity.summary
\`\`\`

### Event Transformation

Transform event data:

\`\`\`
on: user.message
  transform:
    content: event.content.toLowerCase()
    words: event.content.split(" ")
  emit: message.processed
    content: transformed.content
    wordCount: transformed.words.length
\`\`\`

### Event Routing

Route events to different handlers:

\`\`\`
on: user.message
  route:
    if: event.content.startsWith("/")
      emit: command.received
        command: event.content
    else:
      emit: message.received
        content: event.content
\`\`\`

## Schema Best Practices

### Use Descriptive Names

\`\`\`
# Good
schema: UserRegistrationRequest
schema: LLMChatResponse
schema: PaymentProcessedEvent

# Bad
schema: Data
schema: Thing
schema: Obj
\`\`\`

### Keep Schemas Focused

\`\`\`
# Good - focused schema
schema: UserMessage
  content: string
  userId: string
  timestamp: number

# Bad - too many responsibilities
schema: Everything
  userContent: string
  userId: string
  llmResponse: string
  systemStatus: string
  errorMessage: string
\`\`\`

### Version Your Schemas

\`\`\`
schema: UserMessageV1
  content: string
  userId: string

schema: UserMessageV2
  content: string
  userId: string
  timestamp: number
  metadata: object
\`\`\`

### Document Complex Schemas

\`\`\`
schema: PaymentRequest
  # Amount in cents (e.g., 1000 = $10.00)
  amount: number
  
  # ISO 4217 currency code
  currency: string
  
  # Customer identifier
  customerId: string
\`\`\`

## Testing Events

### Unit Testing

\`\`\`javascript
import { AgenticFlow } from 'agentic-flow';

test('emits correct event', async () => {
  const af = new AgenticFlow();
  await af.loadDocument(document);
  
  const events = [];
  af.on('bot.message', (event) => {
    events.push(event);
  });
  
  await af.emit('user.message', { content: 'Hello' });
  
  expect(events).toHaveLength(1);
  expect(events[0].content).toBeDefined();
});
\`\`\`

### Schema Testing

\`\`\`javascript
test('validates schema correctly', async () => {
  const af = new AgenticFlow();
  await af.loadDocument(document);
  
  // Valid event
  await expect(
    af.emit('user.message', {
      content: 'Hello',
      userId: 'user123',
      timestamp: 1234567890
    })
  ).resolves.not.toThrow();
  
  // Invalid event
  await expect(
    af.emit('user.message', {
      content: 'Hello'
      // Missing required fields
    })
  ).rejects.toThrow();
});
\`\`\`

## Debugging Events

### Event Logging

\`\`\`
on: user.message
  log: "Received message: " + event.content
  log: "From user: " + event.userId
\`\`\`

### Event Tracing

Enable event tracing:

\`\`\`javascript
const af = new AgenticFlow({ trace: true });

af.on('event.emitted', (event) => {
  console.log('Event:', event.type, event.data);
});
\`\`\`

## Next Steps

- Learn about [Token Efficiency](/concepts/token-efficiency) for optimizing LLM usage
- Explore [Namespaces](/concepts/namespaces) for organizing functionality
- Read [Schema Management](/best-practices/schema-management) best practices

---

**Examples**: Check out [event patterns](https://github.com/agentic-flow/examples/events) in our GitHub repository.
\`\`\`
