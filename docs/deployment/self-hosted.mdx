---
title: "Self-Hosted Deployment"
description: "Deploy AgentML agents on your own infrastructure"
---

# Self-Hosted Deployment

Run AgentML agents on your own servers for complete control, privacy, and customization.

## System Requirements

- **OS**: Linux, macOS, or Windows
- **Memory**: 512MB minimum (2GB+ recommended for LLM operations)
- **CPU**: 1 core minimum (2+ cores recommended)
- **Disk**: 500MB for runtime + storage for agent files and memory database

## Installation

Install agentmlx on your server:

```bash
# Install agentmlx
curl -fsSL https://raw.githubusercontent.com/agentflare-ai/agentml/main/install.sh | sh

# Verify installation
agentmlx --version
```

## Process Management

### Systemd Service

Create a systemd service for automatic startup and management:

**/etc/systemd/system/agentml-agent.service:**
```ini
[Unit]
Description=AgentML Agent Service
After=network.target

[Service]
Type=simple
User=agentml
Group=agentml
WorkingDirectory=/opt/agentml
ExecStart=/usr/local/bin/agentmlx run agents/main.aml
Restart=on-failure
RestartSec=10s

# Environment variables
Environment="GEMINI_API_KEY=your_key_here"
Environment="AGENTML_MEMORY_DB=/var/lib/agentml/memory.db"

# Security
NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=strict
ProtectHome=true
ReadWritePaths=/var/lib/agentml

[Install]
WantedBy=multi-user.target
```

Enable and start:

```bash
# Create user
sudo useradd -r -s /bin/false agentml

# Create directories
sudo mkdir -p /opt/agentml/agents
sudo mkdir -p /var/lib/agentml
sudo chown -R agentml:agentml /opt/agentml /var/lib/agentml

# Enable service
sudo systemctl daemon-reload
sudo systemctl enable agentml-agent
sudo systemctl start agentml-agent

# Check status
sudo systemctl status agentml-agent

# View logs
sudo journalctl -u agentml-agent -f
```

### Supervisor

Alternative: Use Supervisor for process management:

**/etc/supervisor/conf.d/agentml.conf:**
```ini
[program:agentml-agent]
command=/usr/local/bin/agentmlx run /opt/agentml/agents/main.aml
directory=/opt/agentml
user=agentml
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/agentml/agent.log
environment=GEMINI_API_KEY="your_key",AGENTML_MEMORY_DB="/var/lib/agentml/memory.db"
```

```bash
sudo supervisorctl reread
sudo supervisorctl update
sudo supervisorctl status agentml-agent
```

## Reverse Proxy

### Nginx

Configure Nginx for HTTP access to agents:

**/etc/nginx/sites-available/agentml:**
```nginx
upstream agentml_backend {
    server 127.0.0.1:8080;
    keepalive 64;
}

server {
    listen 80;
    server_name agent.yourdomain.com;

    # Redirect HTTP to HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name agent.yourdomain.com;

    # SSL configuration
    ssl_certificate /etc/letsencrypt/live/agent.yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/agent.yourdomain.com/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    # Proxy to agent
    location / {
        proxy_pass http://agentml_backend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # Timeouts
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # Health check endpoint
    location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }
}
```

Enable and obtain SSL certificate:

```bash
# Enable site
sudo ln -s /etc/nginx/sites-available/agentml /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx

# Get SSL certificate
sudo certbot --nginx -d agent.yourdomain.com
```

### Caddy

Simpler alternative with automatic HTTPS:

**/etc/caddy/Caddyfile:**
```caddy
agent.yourdomain.com {
    reverse_proxy localhost:8080

    log {
        output file /var/log/caddy/agent.log
    }
}
```

```bash
sudo systemctl reload caddy
```

## Environment Management

Store sensitive configuration securely:

**/opt/agentml/.env:**
```bash
GEMINI_API_KEY=your_gemini_key
OLLAMA_BASE_URL=http://localhost:11434
AGENTML_MEMORY_DB=/var/lib/agentml/memory.db
```

Load in service:

```ini
# In systemd service file
EnvironmentFile=/opt/agentml/.env
```

## Local Ollama Setup

Run Ollama alongside agents for local LLM support:

```bash
# Install Ollama
curl https://ollama.ai/install.sh | sh

# Create systemd service
sudo systemctl enable ollama
sudo systemctl start ollama

# Pull models
ollama pull llama2
ollama pull mistral
```

## Monitoring

### Log Management

Centralized logging with rsyslog:

**/etc/rsyslog.d/30-agentml.conf:**
```
if $programname == 'agentml-agent' then /var/log/agentml/agent.log
& stop
```

Log rotation:

**/etc/logrotate.d/agentml:**
```
/var/log/agentml/*.log {
    daily
    rotate 14
    compress
    delaycompress
    notifempty
    create 0640 agentml agentml
    sharedscripts
    postrotate
        systemctl reload agentml-agent > /dev/null 2>&1 || true
    endscript
}
```

### Health Monitoring

Create health check script:

**/opt/agentml/scripts/health-check.sh:**
```bash
#!/bin/bash
set -e

# Check if service is running
if ! systemctl is-active --quiet agentml-agent; then
    echo "CRITICAL: agentml-agent service is not running"
    exit 2
fi

# Check if agent is responsive
if ! agentmlx validate /opt/agentml/agents/main.aml > /dev/null 2>&1; then
    echo "CRITICAL: Agent validation failed"
    exit 2
fi

# Check memory database
if [ ! -f /var/lib/agentml/memory.db ]; then
    echo "WARNING: Memory database not found"
    exit 1
fi

echo "OK: All checks passed"
exit 0
```

Add to cron for monitoring:

```bash
# Check every 5 minutes
*/5 * * * * /opt/agentml/scripts/health-check.sh || /opt/agentml/scripts/alert.sh
```

## Backup Strategy

### Database Backup

**/opt/agentml/scripts/backup.sh:**
```bash
#!/bin/bash
BACKUP_DIR="/var/backups/agentml"
DATE=$(date +%Y%m%d_%H%M%S)

mkdir -p $BACKUP_DIR

# Backup memory database
cp /var/lib/agentml/memory.db $BACKUP_DIR/memory_$DATE.db

# Backup agent files
tar -czf $BACKUP_DIR/agents_$DATE.tar.gz /opt/agentml/agents

# Keep only last 30 days
find $BACKUP_DIR -name "*.db" -mtime +30 -delete
find $BACKUP_DIR -name "*.tar.gz" -mtime +30 -delete

echo "Backup completed: $DATE"
```

Schedule daily backups:

```bash
# Daily at 2 AM
0 2 * * * /opt/agentml/scripts/backup.sh
```

## Security Hardening

### Firewall

```bash
# UFW firewall
sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable

# Or iptables
sudo iptables -A INPUT -p tcp --dport 22 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 443 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 8080 -s 127.0.0.1 -j ACCEPT
sudo iptables -A INPUT -j DROP
```

### Fail2ban

Protect against brute force:

**/etc/fail2ban/jail.local:**
```ini
[agentml]
enabled = true
port = 80,443
filter = agentml
logpath = /var/log/nginx/access.log
maxretry = 5
bantime = 3600
```

### Automatic Updates

Keep system secure:

```bash
# Enable unattended upgrades (Debian/Ubuntu)
sudo apt install unattended-upgrades
sudo dpkg-reconfigure -plow unattended-upgrades

# Auto-update agentmlx (add to cron)
0 3 * * 0 curl -fsSL https://raw.githubusercontent.com/agentflare-ai/agentml/main/install.sh | sh
```

## Scaling

### Multiple Agents

Run multiple agents on different ports:

```ini
# /etc/systemd/system/agentml-worker@.service
[Unit]
Description=AgentML Worker %i
After=network.target

[Service]
Type=simple
User=agentml
WorkingDirectory=/opt/agentml
ExecStart=/usr/local/bin/agentmlx run agents/worker.aml --port 808%i
Environment="WORKER_ID=%i"
Restart=on-failure

[Install]
WantedBy=multi-user.target
```

Start multiple instances:

```bash
sudo systemctl enable agentml-worker@{1..5}
sudo systemctl start agentml-worker@{1..5}
```

### Load Balancing

Nginx load balancing:

```nginx
upstream agentml_workers {
    least_conn;
    server 127.0.0.1:8081;
    server 127.0.0.1:8082;
    server 127.0.0.1:8083;
    keepalive 32;
}

server {
    listen 80;
    location / {
        proxy_pass http://agentml_workers;
    }
}
```

## Performance Tuning

System limits:

**/etc/security/limits.conf:**
```
agentml soft nofile 65536
agentml hard nofile 65536
agentml soft nproc 4096
agentml hard nproc 4096
```

## Best Practices

1. **Use systemd**: Automatic restart and management
2. **Enable HTTPS**: Always use SSL certificates
3. **Isolate users**: Run agents as dedicated user
4. **Monitor logs**: Set up log aggregation
5. **Backup regularly**: Automate database backups
6. **Update frequently**: Keep agentmlx and system updated
7. **Limit resources**: Use systemd resource controls
8. **Monitor health**: Automated health checks
9. **Secure secrets**: Never commit API keys
10. **Test backups**: Regularly verify restore procedures

## Next Steps

- Try [Docker Deployment](/deployment/docker) for containerization
- Learn about [Vercel Deployment](/deployment/vercel) for serverless
- Read [Performance](/best-practices/performance) for optimization
- See [Error Handling](/best-practices/error-handling) for robust agents
